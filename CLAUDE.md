# プロダクト概要

この食堂管理システムは、社内食堂・フードコート・家庭内料理など、様々な環境での料理のやりとりを効率化することを目的としています。
注文から提供まで一元管理し、利用者と提供者双方の体験を向上させます。

## ユースケース・利用シーン

- **多様な利用環境**: 社内食堂、ショッピングモールのフードコート、家族間の夕食手配まで幅広く対応
- **リアルタイム管理**: 注文状況をリアルタイムで把握し、効率的なオペレーションを実現
- **直感的な UI**: 料理選択から注文完了まで、誰でも簡単に操作可能
- **運用効率化**: 料理提供者の作業効率を向上し、待ち時間を削減

### 1. 社内食堂での利用

- **利用者（customer）**: 昼休みに席からメニューを確認し、あらかじめ注文
- **調理スタッフ（chef）**: 注文一覧で効率的に調理計画を立て、完了時に提供済みマーク
- **効果**: 昼休みの混雑軽減、調理計画の最適化

### 2. フードコートでの利用

- **お客様**: 各店舗のメニューを比較検討し、混雑状況を把握して注文
- **店舗スタッフ**: 複数店舗の注文を一元管理、ピーク時の効率的な調理
- **効果**: 顧客満足度向上、オペレーション効率化

### 3. 家庭内での利用

- **家族（customer）**: 夕食のリクエストを事前に伝達
- **料理担当者（chef）**: 家族の希望を把握し、買い物・調理の計画を立案
- **効果**: 家庭内コミュニケーション円滑化、食事準備の効率化

## 機能仕様詳細

### 認証・ユーザー管理機能

- **ユーザー認証**: DeviseTokenAuth によるセキュアなトークンベース認証
- **ロール管理**: `customer`（利用者）と `chef`（提供者）の 2 種類
- **セッション管理**: 自動ログアウト・トークン更新によるセキュリティ確保

### 料理管理機能

- **メニュー表示**: 料理名・価格を一覧表示（認証不要でアクセス可能）
- **料理情報**: 各料理の詳細情報（価格、説明等）
- **将来拡張**: 画像表示、カテゴリ分類、在庫管理への対応準備済み

### 注文管理機能

- **注文作成**: ログインユーザーによる料理の注文（数量指定可能）
- **注文履歴**: ユーザー個別の注文履歴を新しい順で表示
- **注文状況**: 提供済み・未提供の状況管理
- **権限制御**: chef ロールのみが提供済みステータスを更新可能

# プロジェクト概要

このプロジェクトは、Docker コンテナによって、バックエンドとフロントエンドがわかれています。

バックエンドは app サービスとして提供されており、フロントエンドは web サービスとして提供されています。

## ディレクトリ構成

- **`frontend/`**: web コンテナにバインド（Nuxt.js アプリケーション）
- **`backend/`**: app コンテナにバインド（Rails API アプリケーション）
- **`docker/`**: Dockerfile とコンテナ設定
- **`compose.yml`**: Docker Compose 設定ファイル

## アーキテクチャ概要

- **SPA + API 構成**: フロントエンド（Nuxt.js）とバックエンド（Rails API）の完全分離
- **コンテナベース**: Docker Compose によるマイクロサービス構成
- **トークンベース認証**: DeviseTokenAuth によるステートレス認証

## コンテナ構成

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │   Backend       │    │  PostgreSQL     │
│   (Nuxt.js 3)   │◄──►│   (Rails 7)     │◄──►│   Database      │
│   Port: 3000    │    │   Port: 3001    │    │   Port: 5432    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
        │                       │
        └──────────────┬────────┘
                       │
             Docker Compose Network
```

## データモデル構造

```
User (ユーザー)
├── id, name, email (基本情報)
├── DeviseTokenAuth認証情報
├── trackable情報（ログイン履歴）
└── has_many: orders (注文履歴)

Dish (料理)
├── id, name, price (基本情報)
├── created_at, updated_at
└── has_many: orders (注文履歴)

Order (注文)
├── user_id, dish_id (関連ID)
├── quantity (注文数量)
├── status (提供状況: boolean)
├── created_at (注文日時)
└── belongs_to: user, dish
```

## セキュリティ機能

- **トークン自動更新**: リクエスト毎にトークンをローテーション
- **セッション管理**: クライアント側でのトークン管理
- **権限制御**: ロールベースの機能制限
- **確認機能**: メール確認によるアカウント有効化
- **追跡機能**: ログイン履歴の記録

# フロントエンド開発ガイドライン

## 技術スタック

- **フロントエンド**: Nuxt.js 3 + TypeScript
  - **パッケージ管理**: npm
  - **テスト**: Vitest + Vue Test Utils
  - **フォーマット**: ESLint + Prettier + TypeScript
  - **型チェック**: TypeScript + Zod 実行時検証
  - **レンダリング**: SPA モード（`ssr: false`）
  - **TypeScript**: 全面採用による型安全性確保
  - **スタイリング**: Tailwind CSS（ユーティリティファースト）
  - **状態管理**: Pinia

## コマンド操作

フロントエンド関連のコマンドは web コンテナ内で実行してください：

```bash
docker compose exec web npm install
docker compose exec web npm run dev
docker compose exec web npm run build
```

## コード品質・フォーマット

以下を考慮し、コードの品質を保ってください：

- **必須**: テスト駆動開発
  - 実装を更新したらテストコードも更新
  - テストコードに記載するテストケース名は日本語で記載
- **必須**: ファイルの末尾には改行を入れて空行を作る
- **必須**: `docker compose exec web npm run format` による自動修正
- **必須**: `docker compose exec web npx tsc --noEmit` による型チェック
- **推奨**: 1 行あたりの文字数は 80 字以内になるように改行
- **推奨**: `const` の使用
- **非推奨**: テストでのモックの乱用
  - 特に実装との乖離を生むような過度なスタブは避け、E2E または統合テストとのバランスを考慮
- **非推奨**: `let` の使用
  - ただし、再代入が明確に必要な場面（ループ変数や一時的な状態）の使用可
- **禁止**: `@ts-ignore` ディレクティブの使用
  - `@ts-expect-error` ディレクティブで代用
- **禁止**: `any` 型の使用
  - ただし、型が取得不能な外部ライブラリや JSON パースなどの場合に限り、理由コメントを添えて明示的に使用可
- **禁止**: `var` の使用
- **禁止**: テストの skip
  - 意図的な未実装は TODO コメントで

# バックエンド開発ガイドライン

## 技術スタック

- **バックエンド**: Rails 7 API Mode + PostgreSQL
  - **認証**: DeviseTokenAuth
  - **フォーマット**: RuboCop
  - **テスト**: RSpec

## コマンド操作

バックエンド関連のコマンドは app コンテナ内で実行してください：

```bash
docker compose exec app rails console
docker compose exec app rails server
docker compose exec app bundle exec rspec
docker compose exec app bundle install
```

## コード品質・フォーマット

以下を考慮し、コードの品質を保ってください：

- **必須**: ファイルの末尾には改行を入れて空行を作る
